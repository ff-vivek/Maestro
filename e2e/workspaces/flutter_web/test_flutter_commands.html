<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flutter Web Commands Test</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        flutter-view {
            display: block;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }
        
        #flutter-content {
            height: 200vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #007bff;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .test-section h2 {
            margin-top: 0;
            font-size: 18px;
        }
        
        .status {
            font-size: 14px;
            padding: 8px 12px;
            border-radius: 4px;
            margin-top: 10px;
            display: inline-block;
        }
        
        .status.waiting {
            background: #ffc107;
            color: #000;
        }
        
        .status.success {
            background: #28a745;
            color: white;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button:active {
            background: #004094;
        }
        
        input[type="text"] {
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ccc;
            border-radius: 4px;
            width: 300px;
            max-width: 100%;
        }
        
        input[type="text"]:focus {
            border-color: #007bff;
            outline: none;
        }
        
        #header {
            background: #28a745;
            padding: 20px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
        }
        
        #footer {
            background: #dc3545;
            padding: 20px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
            margin-top: auto;
        }
        
        .counter {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <flutter-view id="flutter-root">
        <div id="flutter-content">
            <div id="header">Flutter Web Commands Test Page</div>
            
            <!-- Test 1: Tap Command -->
            <div class="test-section" data-testid="tap-section">
                <h2>Test 1: Tap Command</h2>
                <p>Click the button below to test tap functionality.</p>
                <button id="tap-button" data-testid="tap-button">Tap Me</button>
                <div id="tap-status" class="status waiting">Status: Waiting for tap...</div>
                <div id="tap-counter" class="counter">Tap count: 0</div>
            </div>
            
            <!-- Test 2: Long Press Command -->
            <div class="test-section" data-testid="longpress-section">
                <h2>Test 2: Long Press Command</h2>
                <p>Press and hold the button for 2+ seconds to test long press.</p>
                <button id="longpress-button" data-testid="longpress-button">Long Press Me</button>
                <div id="longpress-status" class="status waiting">Status: Waiting for long press...</div>
                <div id="longpress-duration" class="counter">Press duration: 0ms</div>
            </div>
            
            <!-- Test 3: Input Text Command -->
            <div class="test-section" data-testid="input-section">
                <h2>Test 3: Input Text Command</h2>
                <p>Type text in the input field below.</p>
                <input type="text" id="text-input" data-testid="text-input" placeholder="Type here...">
                <div id="input-status" class="status waiting">Status: Waiting for input...</div>
                <div id="input-value" class="counter">Current value: ""</div>
            </div>
            
            <!-- Test 4: Erase Text Command -->
            <div class="test-section" data-testid="erase-section">
                <h2>Test 4: Erase Text Command</h2>
                <p>This field has pre-filled text. Test erasing it.</p>
                <input type="text" id="erase-input" data-testid="erase-input" value="Delete this text">
                <div id="erase-status" class="status waiting">Status: Contains "Delete this text"</div>
                <div id="erase-value" class="counter">Characters remaining: 16</div>
            </div>
            
            <!-- Test 5: Press Key Command (Enter) -->
            <div class="test-section" data-testid="presskey-section">
                <h2>Test 5: Press Key Command</h2>
                <p>Focus the input and press Enter key.</p>
                <input type="text" id="presskey-input" data-testid="presskey-input" placeholder="Press Enter here...">
                <div id="presskey-status" class="status waiting">Status: Waiting for Enter key...</div>
            </div>
            
            <!-- Test 6: Scroll Section (at bottom) -->
            <div class="test-section" data-testid="scroll-section">
                <h2>Test 6: Scroll Test</h2>
                <p>This section is at the bottom. If you can see this, scroll worked!</p>
                <div id="scroll-status" class="status success">Scroll successful - you found the bottom!</div>
            </div>
            
            <div id="footer" data-testid="footer">END OF PAGE - All Tests Above</div>
        </div>
    </flutter-view>
    
    <script>
        console.log('[Test Page] Initializing Flutter Web Commands Test Page...');
        
        const flutterView = document.querySelector('flutter-view');
        const content = document.getElementById('flutter-content');
        let scrollPosition = 0;
        
        // ============ Flutter Detection Setup ============
        // Add Flutter markers so Maestro detects this as a Flutter app
        const glassPane = document.createElement('div');
        glassPane.setAttribute('flt-glass-pane', '');
        glassPane.style.cssText = 'position: absolute; pointer-events: none;';
        flutterView.appendChild(glassPane);
        document.body.setAttribute('flt-renderer', 'html');
        
        // ============ Wheel Event Handler (Flutter Scroll) ============
        flutterView.addEventListener('wheel', (event) => {
            event.preventDefault();
            
            let deltaY = event.deltaY;
            if (event.deltaMode === 1) deltaY *= 16;
            else if (event.deltaMode === 2) deltaY *= window.innerHeight;
            
            scrollPosition += deltaY;
            const maxScroll = content.scrollHeight - window.innerHeight;
            scrollPosition = Math.max(0, Math.min(scrollPosition, maxScroll));
            
            content.style.transform = `translateY(-${scrollPosition}px)`;
            content.style.transition = 'transform 0.1s ease-out';
            
            console.log('[Test Page] Wheel scroll:', { deltaY, scrollPosition });
        }, { passive: false });
        
        // ============ Pointer Event Handlers (Flutter-style) ============
        // Flutter web apps handle pointer events, not just click events
        let pointerDownTime = 0;
        let pointerDownTarget = null;
        
        flutterView.addEventListener('pointerdown', (event) => {
            pointerDownTime = Date.now();
            pointerDownTarget = event.target;
            console.log('[Test Page] Pointer down on:', event.target.id || event.target.tagName);
        });
        
        flutterView.addEventListener('pointerup', (event) => {
            const duration = Date.now() - pointerDownTime;
            console.log('[Test Page] Pointer up, duration:', duration, 'ms');
            
            // Check if this was a long press (2+ seconds)
            if (duration >= 2000 && pointerDownTarget === event.target) {
                handleLongPress(event.target);
            }
        });
        
        // ============ Test 1: Tap Button ============
        let tapCount = 0;
        const tapButton = document.getElementById('tap-button');
        const tapStatus = document.getElementById('tap-status');
        const tapCounter = document.getElementById('tap-counter');
        
        tapButton.addEventListener('click', () => {
            tapCount++;
            tapStatus.textContent = 'Status: Tap detected!';
            tapStatus.className = 'status success';
            tapCounter.textContent = `Tap count: ${tapCount}`;
            console.log('[Test Page] TAP detected! Count:', tapCount);
        });
        
        // Also listen for pointer events (Flutter-style)
        tapButton.addEventListener('pointerup', (event) => {
            const duration = Date.now() - pointerDownTime;
            if (duration < 500 && pointerDownTarget === tapButton) {
                // This is a tap via pointer events
                console.log('[Test Page] Pointer tap on button');
            }
        });
        
        // ============ Test 2: Long Press Button ============
        const longpressButton = document.getElementById('longpress-button');
        const longpressStatus = document.getElementById('longpress-status');
        const longpressDuration = document.getElementById('longpress-duration');
        let longPressTimer = null;
        let pressStartTime = 0;
        
        function handleLongPress(target) {
            if (target === longpressButton || target.id === 'longpress-button') {
                const duration = Date.now() - pressStartTime;
                longpressStatus.textContent = 'Status: Long press detected!';
                longpressStatus.className = 'status success';
                longpressDuration.textContent = `Press duration: ${duration}ms`;
                console.log('[Test Page] LONG PRESS detected! Duration:', duration);
            }
        }
        
        longpressButton.addEventListener('mousedown', () => {
            pressStartTime = Date.now();
            longPressTimer = setInterval(() => {
                const duration = Date.now() - pressStartTime;
                longpressDuration.textContent = `Press duration: ${duration}ms`;
            }, 100);
        });
        
        longpressButton.addEventListener('mouseup', () => {
            clearInterval(longPressTimer);
            const duration = Date.now() - pressStartTime;
            if (duration >= 2000) {
                handleLongPress(longpressButton);
            }
        });
        
        longpressButton.addEventListener('mouseleave', () => {
            clearInterval(longPressTimer);
        });
        
        // ============ Test 3: Input Text ============
        const textInput = document.getElementById('text-input');
        const inputStatus = document.getElementById('input-status');
        const inputValue = document.getElementById('input-value');
        
        textInput.addEventListener('input', () => {
            const value = textInput.value;
            inputValue.textContent = `Current value: "${value}"`;
            if (value.length > 0) {
                inputStatus.textContent = 'Status: Text entered!';
                inputStatus.className = 'status success';
            } else {
                inputStatus.textContent = 'Status: Waiting for input...';
                inputStatus.className = 'status waiting';
            }
            console.log('[Test Page] INPUT value:', value);
        });
        
        // ============ Test 4: Erase Text ============
        const eraseInput = document.getElementById('erase-input');
        const eraseStatus = document.getElementById('erase-status');
        const eraseValue = document.getElementById('erase-value');
        
        eraseInput.addEventListener('input', () => {
            const value = eraseInput.value;
            const remaining = value.length;
            eraseValue.textContent = `Characters remaining: ${remaining}`;
            if (remaining === 0) {
                eraseStatus.textContent = 'Status: All text erased!';
                eraseStatus.className = 'status success';
            } else if (remaining < 16) {
                eraseStatus.textContent = `Status: ${16 - remaining} characters erased`;
                eraseStatus.className = 'status waiting';
            }
            console.log('[Test Page] ERASE remaining:', remaining);
        });
        
        // ============ Test 5: Press Key (Enter) ============
        const presskeyInput = document.getElementById('presskey-input');
        const presskeyStatus = document.getElementById('presskey-status');
        
        presskeyInput.addEventListener('keydown', (event) => {
            console.log('[Test Page] Key pressed:', event.key, event.keyCode);
            if (event.key === 'Enter' || event.keyCode === 13) {
                presskeyStatus.textContent = 'Status: Enter key pressed!';
                presskeyStatus.className = 'status success';
                console.log('[Test Page] ENTER key detected!');
            }
        });
        
        // ============ Mouse Event Logging ============
        flutterView.addEventListener('mouseover', (event) => {
            // Flutter expects mouseover events
        });
        
        flutterView.addEventListener('mousemove', (event) => {
            // Flutter tracks mouse position
        });
        
        // ============ Initialization Complete ============
        console.log('[Test Page] ==================================');
        console.log('[Test Page] Flutter Web Commands Test Page Ready');
        console.log('[Test Page] Flutter markers:', {
            flutterView: !!flutterView,
            glassPane: !!document.querySelector('[flt-glass-pane]'),
            fltRenderer: document.body.hasAttribute('flt-renderer')
        });
        console.log('[Test Page] ==================================');
    </script>
</body>
</html>
